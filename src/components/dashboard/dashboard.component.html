<div class="min-h-screen bg-slate-900 pt-24 pb-12">
  <div class="container mx-auto px-4 max-w-6xl">
    
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
      <div class="flex items-center gap-4">
        <div class="w-16 h-16 rounded-full bg-slate-800 border-2 border-cyan-500 overflow-hidden flex items-center justify-center">
          @if (profileData().avatar_url) {
            <img [src]="profileData().avatar_url" alt="Avatar" class="w-full h-full object-cover">
          } @else {
            <lucide-icon [name]="User" class="w-8 h-8 text-cyan-500"></lucide-icon>
          }
        </div>
        <div>
          <h1 class="text-2xl font-bold text-white">خوش آمدید، {{ profileData().name || 'کاربر' }}</h1>
          <p class="text-slate-400 text-sm">{{ authService.currentUser()?.email }}</p>
        </div>
      </div>
      <button (click)="logout()" class="flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 text-red-400 rounded-lg transition-colors border border-slate-700">
        <lucide-icon [name]="LogOut" class="w-4 h-4"></lucide-icon>
        <span>خروج از حساب</span>
      </button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      
      <!-- Sidebar Navigation -->
      <div class="lg:col-span-1">
        <div class="bg-slate-800 rounded-2xl p-4 border border-slate-700 space-y-2 sticky top-24">
          <button (click)="setTab('daily')" [class.bg-cyan-900]="activeTab() === 'daily'" [class.text-cyan-400]="activeTab() === 'daily'" [class.text-slate-300]="activeTab() !== 'daily'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-700 transition-colors text-right">
            <lucide-icon [name]="Calendar" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">اخبار و رویدادهای روز</span>
          </button>

          <button (click)="setTab('profile')" [class.bg-cyan-900]="activeTab() === 'profile'" [class.text-cyan-400]="activeTab() === 'profile'" [class.text-slate-300]="activeTab() !== 'profile'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-700 transition-colors text-right">
            <lucide-icon [name]="User" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">پروفایل کاربری</span>
          </button>
          
          <button (click)="setTab('wallet')" [class.bg-cyan-900]="activeTab() === 'wallet'" [class.text-cyan-400]="activeTab() === 'wallet'" [class.text-slate-300]="activeTab() !== 'wallet'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-700 transition-colors text-right">
            <lucide-icon [name]="Wallet" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">کیف پول ترون</span>
          </button>

          <button (click)="setTab('apps')" [class.bg-cyan-900]="activeTab() === 'apps'" [class.text-cyan-400]="activeTab() === 'apps'" [class.text-slate-300]="activeTab() !== 'apps'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-700 transition-colors text-right">
            <lucide-icon [name]="LayoutGrid" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">سرویس‌ها و اپلیکیشن‌ها</span>
          </button>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="lg:col-span-3">
        <div class="bg-slate-800 rounded-2xl p-6 md:p-8 border border-slate-700 min-h-[500px]">
          
          <!-- Daily Content Tab -->
          @if (activeTab() === 'daily') {
            <div class="animate-in fade-in duration-300">
              <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <lucide-icon [name]="Calendar" class="w-5 h-5 text-cyan-400"></lucide-icon>
                رویدادها و اخبار امروز
              </h2>

              @if (dailyContentService.isLoading()) {
                <div class="flex flex-col items-center justify-center py-20 text-slate-400">
                  <lucide-icon [name]="Loader2" class="w-10 h-10 animate-spin mb-4 text-cyan-500"></lucide-icon>
                  <p>در حال دریافت جدیدترین اخبار و اطلاعات امروز...</p>
                  <p class="text-sm mt-2 opacity-70">این عملیات ممکن است چند ثانیه طول بکشد</p>
                </div>
              } @else if (dailyContentService.error()) {
                <div class="bg-red-500/10 border border-red-500/20 rounded-xl p-6 text-center">
                  <p class="text-red-400 mb-4">{{ dailyContentService.error() }}</p>
                  <button (click)="dailyContentService.fetchTodayContent()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                    تلاش مجدد
                  </button>
                </div>
              } @else if (dailyContentService.content()) {
                <div class="space-y-8">
                  <!-- Date Header -->
                  <div class="flex flex-col sm:flex-row justify-between items-center bg-slate-900/50 p-4 rounded-xl border border-slate-700/50">
                    <div class="text-lg font-medium text-cyan-400">{{ dailyContentService.content()?.jalaliDate }}</div>
                    <div class="text-sm text-slate-400 font-mono">{{ dailyContentService.content()?.gregorianDate }}</div>
                  </div>

                  <!-- News Grid -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Iran News -->
                    <div class="bg-slate-900 rounded-xl p-5 border border-slate-700">
                      <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                        <lucide-icon [name]="MapPin" class="w-5 h-5 text-emerald-400"></lucide-icon>
                        اخبار مهم ایران
                      </h3>
                      <ul class="space-y-3">
                        @for (news of dailyContentService.content()?.iranNews; track $index) {
                          <li class="text-slate-300 text-sm leading-relaxed flex gap-2">
                            <span class="text-emerald-500 mt-1">•</span>
                            <span>{{ news }}</span>
                          </li>
                        }
                      </ul>
                    </div>

                    <!-- World News -->
                    <div class="bg-slate-900 rounded-xl p-5 border border-slate-700">
                      <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                        <lucide-icon [name]="Globe" class="w-5 h-5 text-blue-400"></lucide-icon>
                        اخبار مهم جهان
                      </h3>
                      <ul class="space-y-3">
                        @for (news of dailyContentService.content()?.worldNews; track $index) {
                          <li class="text-slate-300 text-sm leading-relaxed flex gap-2">
                            <span class="text-blue-500 mt-1">•</span>
                            <span>{{ news }}</span>
                          </li>
                        }
                      </ul>
                    </div>
                  </div>

                  <!-- Astrology -->
                  <div class="bg-gradient-to-br from-indigo-900/40 to-purple-900/40 rounded-xl p-6 border border-indigo-500/20 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl -mr-10 -mt-10"></div>
                    <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2 relative z-10">
                      <lucide-icon [name]="Sparkles" class="w-5 h-5 text-purple-400"></lucide-icon>
                      انرژی و طالع امروز
                    </h3>
                    <p class="text-slate-300 leading-relaxed text-sm relative z-10">
                      {{ dailyContentService.content()?.astrology }}
                    </p>
                  </div>

                  <!-- Quote -->
                  <div class="bg-slate-900 rounded-xl p-6 border border-slate-700 text-center relative">
                    <lucide-icon [name]="Quote" class="w-8 h-8 text-slate-700 absolute top-4 right-4"></lucide-icon>
                    <p class="text-lg text-slate-300 italic font-serif leading-relaxed px-8 py-2">
                      "{{ dailyContentService.content()?.quote }}"
                    </p>
                  </div>
                </div>
              }
            </div>
          }

          <!-- Profile Tab -->
          @if (activeTab() === 'profile') {
            <div class="animate-in fade-in duration-300">
              <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <lucide-icon [name]="Edit3" class="w-5 h-5 text-cyan-400"></lucide-icon>
                ویرایش مشخصات فردی
              </h2>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                  <label class="text-sm text-slate-400 block">نام و نام خانوادگی</label>
                  <input [(ngModel)]="profileData().name" type="text" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors">
                </div>
                
                <div class="space-y-2">
                  <label class="text-sm text-slate-400 block">شماره تلفن</label>
                  <div class="relative">
                    <lucide-icon [name]="Phone" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"></lucide-icon>
                    <input [(ngModel)]="profileData().phone" type="tel" class="w-full bg-slate-900 border border-slate-700 rounded-lg pl-10 pr-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors text-left" dir="ltr" placeholder="0912...">
                  </div>
                </div>

                <div class="space-y-2">
                  <label class="text-sm text-slate-400 block">استان</label>
                  <input [(ngModel)]="profileData().province" type="text" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors">
                </div>

                <div class="space-y-2">
                  <label class="text-sm text-slate-400 block">شهر</label>
                  <input [(ngModel)]="profileData().city" type="text" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors">
                </div>

                <div class="space-y-2 md:col-span-2">
                  <label class="text-sm text-slate-400 block">آدرس دقیق</label>
                  <div class="relative">
                    <lucide-icon [name]="MapPin" class="absolute right-3 top-3 w-4 h-4 text-slate-500"></lucide-icon>
                    <textarea [(ngModel)]="profileData().address" rows="2" class="w-full bg-slate-900 border border-slate-700 rounded-lg pr-10 pl-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
                  </div>
                </div>

                <div class="space-y-2 md:col-span-2">
                  <label class="text-sm text-slate-400 block">درباره من (بایو)</label>
                  <textarea [(ngModel)]="profileData().bio" rows="3" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
                </div>

                <div class="space-y-2 md:col-span-2">
                  <label class="text-sm text-slate-400 block">لینک عکس پروفایل (URL)</label>
                  <div class="relative">
                    <lucide-icon [name]="ImageIcon" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"></lucide-icon>
                    <input [(ngModel)]="profileData().avatar_url" type="url" class="w-full bg-slate-900 border border-slate-700 rounded-lg pl-10 pr-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors text-left" dir="ltr" placeholder="https://...">
                  </div>
                </div>
              </div>
            </div>
          }

          <!-- Wallet Tab -->
          @if (activeTab() === 'wallet') {
            <div class="animate-in fade-in duration-300">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <h2 class="text-xl font-bold text-white flex items-center gap-2">
                  <lucide-icon [name]="Wallet" class="w-5 h-5 text-cyan-400"></lucide-icon>
                  مدیریت کیف پول ترون (TRX)
                </h2>
                <button (click)="connectTronLink()" class="flex items-center gap-2 px-4 py-2 bg-red-600/10 hover:bg-red-600/20 text-red-400 border border-red-600/30 rounded-lg transition-colors text-sm font-medium">
                  <lucide-icon [name]="Link" class="w-4 h-4"></lucide-icon>
                  اتصال به TronLink
                </button>
              </div>
              
              <div class="bg-slate-900 rounded-xl p-6 border border-slate-700 mb-6">
                <p class="text-slate-400 text-sm mb-4 leading-relaxed">
                  آدرس کیف پول ترون (TRC20) خود را در کادر زیر وارد کنید یا از طریق افزونه TronLink متصل شوید. این آدرس برای دریافت پاداش‌ها، برداشت موجودی و استفاده از سرویس‌های مالی پلتفرم استفاده خواهد شد.
                </p>
                
                <div class="space-y-2">
                  <label class="text-sm text-slate-300 font-medium block">آدرس کیف پول ترون</label>
                  <input [(ngModel)]="profileData().tron_wallet" type="text" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-4 text-white focus:outline-none focus:border-cyan-500 transition-colors text-left font-mono tracking-wider" dir="ltr" placeholder="T...">
                </div>
                
                @if (profileData().tron_wallet) {
                  <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Balance Card -->
                    <div class="bg-slate-800 rounded-xl p-5 border border-slate-700 relative overflow-hidden">
                      <div class="absolute top-0 right-0 w-32 h-32 bg-cyan-500/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
                      <div class="flex justify-between items-start mb-4 relative z-10">
                        <div class="text-slate-400 text-sm">موجودی (TRX)</div>
                        <button (click)="fetchTronBalance(profileData().tron_wallet!)" [disabled]="isFetchingBalance()" class="text-cyan-400 hover:text-cyan-300 transition-colors">
                          <lucide-icon [name]="RefreshCw" class="w-5 h-5" [class.animate-spin]="isFetchingBalance()"></lucide-icon>
                        </button>
                      </div>
                      <div class="text-3xl font-bold text-white mb-1 relative z-10 font-mono">
                        @if (trxBalance() !== null) {
                          {{ trxBalance() | number:'1.0-2' }} <span class="text-sm text-cyan-400 font-sans">TRX</span>
                        } @else {
                          <span class="text-slate-500 text-lg">---</span>
                        }
                      </div>
                      <div class="flex gap-2 mt-6 relative z-10">
                        <button class="flex-1 flex items-center justify-center gap-1 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-sm font-medium transition-colors">
                          <lucide-icon [name]="ArrowDownLeft" class="w-4 h-4"></lucide-icon>
                          دریافت
                        </button>
                        <button class="flex-1 flex items-center justify-center gap-1 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm font-medium transition-colors">
                          <lucide-icon [name]="ArrowUpRight" class="w-4 h-4"></lucide-icon>
                          ارسال
                        </button>
                      </div>
                    </div>

                    <!-- QR Code Card -->
                    <div class="bg-slate-800 rounded-xl p-5 border border-slate-700 flex flex-col items-center justify-center text-center">
                      <div class="bg-white p-2 rounded-lg mb-3">
                        <img [src]="'https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=' + profileData().tron_wallet" alt="QR Code" class="w-24 h-24">
                      </div>
                      <p class="text-xs text-slate-400 font-mono break-all px-4">{{ profileData().tron_wallet }}</p>
                    </div>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Apps Tab -->
          @if (activeTab() === 'apps') {
            <div class="animate-in fade-in duration-300">
              <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <lucide-icon [name]="LayoutGrid" class="w-5 h-5 text-cyan-400"></lucide-icon>
                سرویس‌ها و اپلیکیشن‌ها
              </h2>
              
              <p class="text-slate-400 mb-8">به زودی اپلیکیشن‌ها و سرویس‌های جدید در این بخش در دسترس شما قرار خواهند گرفت.</p>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Placeholder App 1 -->
                <div class="bg-slate-900 rounded-xl p-6 border border-slate-700 border-dashed flex flex-col items-center justify-center text-center opacity-60 hover:opacity-100 transition-opacity cursor-not-allowed group">
                  <div class="w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center mb-4 group-hover:bg-cyan-900/50 transition-colors">
                    <lucide-icon [name]="LayoutGrid" class="w-6 h-6 text-slate-500 group-hover:text-cyan-400"></lucide-icon>
                  </div>
                  <h3 class="text-white font-medium mb-1">فروشگاه اختصاصی</h3>
                  <span class="text-xs px-2 py-1 bg-slate-800 text-slate-400 rounded-md">به زودی</span>
                </div>
                
                <!-- Placeholder App 2 -->
                <div class="bg-slate-900 rounded-xl p-6 border border-slate-700 border-dashed flex flex-col items-center justify-center text-center opacity-60 hover:opacity-100 transition-opacity cursor-not-allowed group">
                  <div class="w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center mb-4 group-hover:bg-cyan-900/50 transition-colors">
                    <lucide-icon [name]="LayoutGrid" class="w-6 h-6 text-slate-500 group-hover:text-cyan-400"></lucide-icon>
                  </div>
                  <h3 class="text-white font-medium mb-1">سیستم همکاری در فروش</h3>
                  <span class="text-xs px-2 py-1 bg-slate-800 text-slate-400 rounded-md">به زودی</span>
                </div>
              </div>
            </div>
          }

          <!-- Save Button (Visible for Profile and Wallet) -->
          @if (activeTab() === 'profile' || activeTab() === 'wallet') {
            <div class="mt-8 pt-6 border-t border-slate-700 flex items-center justify-between">
              <div>
                @if (saveMessage()) {
                  <span [class.text-emerald-400]="saveMessage()?.type === 'success'" [class.text-red-400]="saveMessage()?.type === 'error'" class="text-sm font-medium animate-in fade-in">
                    {{ saveMessage()?.text }}
                  </span>
                }
              </div>
              <button (click)="saveProfile()" [disabled]="isSaving()" class="flex items-center gap-2 px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition-colors disabled:opacity-70 disabled:cursor-not-allowed">
                @if (isSaving()) {
                  <lucide-icon [name]="Loader2" class="w-5 h-5 animate-spin"></lucide-icon>
                  <span>در حال ذخیره...</span>
                } @else {
                  <lucide-icon [name]="Save" class="w-5 h-5"></lucide-icon>
                  <span>ذخیره تغییرات</span>
                }
              </button>
            </div>
          }

        </div>
      </div>
    </div>
  </div>
</div>
